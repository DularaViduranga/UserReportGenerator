<div class="analytics-container">
  <div class="header">
    <h2>Achievement Analytics</h2>
    <p>Visualize target vs achievement performance across regions and time periods</p>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group" *ngIf="!isBranchUser">
        <label for="viewMode">View Mode:</label>
        <select 
          id="viewMode" 
          [(ngModel)]="viewMode" 
          (change)="onViewModeChange()"
          class="form-control">
          <option value="regional">Regional Analysis</option>
          <option value="branch">Branch Analysis</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="year">Year:</label>
        <select 
          id="year" 
          [(ngModel)]="selectedYear" 
          (change)="onFiltersChange()"
          class="form-control">
          <option *ngFor="let year of years" [value]="year">
            {{ year }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="month">Month:</label>
        <select 
          id="month" 
          [(ngModel)]="selectedMonth" 
          (change)="onFiltersChange()"
          class="form-control">
          <option *ngFor="let month of months" [value]="month.value">
            {{ month.name }}
          </option>
        </select>
      </div>

      <div class="filter-group" *ngIf="viewMode === 'regional' && !isBranchUser">
        <label for="region">Region:</label>
        <select 
          id="region" 
          [(ngModel)]="selectedRegionId" 
          (change)="onRegionChange()"
          class="form-control">
          <option [value]="null">-- Select Region --</option>
          <option *ngFor="let region of regions" [value]="region.id">
            {{ region.rgnName }}
          </option>
        </select>
      </div>

      <div class="filter-group" *ngIf="viewMode === 'branch' && !isBranchUser">
        <label for="region">Region:</label>
        <select 
          id="region" 
          [(ngModel)]="selectedRegionId" 
          (change)="onRegionChange()"
          class="form-control">
          <option [value]="null">-- Select Region --</option>
          <option *ngFor="let region of regions" [value]="region.id">
            {{ region.rgnName }}
          </option>
        </select>
      </div>

      <div class="filter-group" *ngIf="viewMode === 'branch' && selectedRegionId && !isBranchUser">
        <label for="branch">Branch:</label>
        <select 
          id="branch" 
          [(ngModel)]="selectedBranchId" 
          (change)="onFiltersChange()"
          class="form-control">
          <option [value]="null">-- Select Branch --</option>
          <option *ngFor="let branch of branches" [value]="branch.id">
            {{ branch.brnName }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Branch User Info Section -->
  <div class="branch-user-info" *ngIf="isBranchUser">
    <div class="info-card">
      <h3>Your Branch Analytics</h3>
      <p><strong>Region:</strong> {{ getRegionName() }}</p>
      <p><strong>Branch:</strong> {{ getBranchName() }}</p>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner-large"></div>
    <p>Loading analytics data...</p>
  </div>

  <!-- Overall Performance Summary -->
  <div class="summary-section" *ngIf="!loading && (totalTarget >= 0 && totalCollection >= 0)">
    <div class="summary-card">
      <h3>Overall Performance Summary</h3>
      <div class="summary-stats">
        <div class="stat-item">
          <div class="stat-value">Rs. {{ totalTarget | number:'1.0-0' }}</div>
          <div class="stat-label">Total Target</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">Rs. {{ totalCollection | number:'1.0-0' }}</div>
          <div class="stat-label">Total Collection</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" [ngClass]="'status-' + getAchievementStatus(overallAchievement)">
            {{ overallAchievement }}%
          </div>
          <div class="stat-label">Achievement Rate</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart Section -->
  <div class="analytics-chart-section" *ngIf="showChart">
    <app-chart
      chartType="line"
      [labels]="chartLabels"
      [datasets]="chartDatasets"
      title="Monthly Targets vs Collections Analysis"
      xAxisTitle="Months"
      yAxisTitle="Amount (Rs.)"
      [height]="400"
      [responsive]="true"
      [showLegend]="true"
      [currencyFormat]="true">
    </app-chart>
  </div>

  <!-- No Data Message -->
  <div class="no-data-section" *ngIf="!loading && !showChart && totalTarget === 0 && totalCollection === 0">
    <div class="no-data-message">
      <i class="fas fa-chart-line"></i>
      <h3>No Analytics Data Available</h3>
      <p *ngIf="!selectedRegionId && viewMode === 'regional'">Please select a region to view analytics.</p>
      <p *ngIf="!selectedBranchId && viewMode === 'branch'">Please select a region and branch to view analytics.</p>
      <p *ngIf="selectedRegionId && viewMode === 'regional'">No data found for the selected filters.</p>
      <p *ngIf="selectedBranchId && viewMode === 'branch'">No data found for the selected filters.</p>
    </div>
  </div>
</div>

